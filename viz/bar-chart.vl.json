{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "A simple bar chart with embedded data.",
  "data": {
    "url": "https://gist.githubusercontent.com/traviskaufman/04c418f335b98cdd36d80a5a88cb5f3b/raw/4b26d78441754c3870d74323f91e9a6fab79f087/art-by-station.csv",
    "format": {
      "parse": {
        "date": "utc:%Y-%m-%d",
        "num_art_pieces": "number",
        "ridership": "number"
      }
    }
  },
  "transform": [
    {
      "filter": "year(datum.date) == 2024"
    },
    {
      "calculate": "datum.stop_name + ' - ' + datum.line + ' (' + datum.borough + ')'",
      "as": "stop_title"
    },
    { "calculate": "datum.ridership / 100000", "as": "ridership_per_100k" },
    {
      "calculate": "datum.num_art_pieces / datum.ridership_per_100k",
      "as": "ratio"
    },
    {
      "fold": ["ridership_per_100k", "num_art_pieces"],
      "as": ["metric", "value"]
    }
  ],
  "mark": "bar",
  "encoding": {
    "y": { "field": "value", "aggregate": "sum" },
    "x": { "field": "stop_title", "sort": { "field": "ratio" } },
    "xOffset": {
      "field": "metric",
      "sort": { "field": "metric", "order": "descending" }
    },
    "color": {
      "field": "metric",
      "sort": { "field": "metric", "order": "descending" },
      "legend": { "orient": "left" }
    },
    "tooltip": [
      { "field": "stop_name" },
      { "field": "line" },
      { "field": "borough" },
      { "field": "num_art_pieces" },
      {
        "field": "ridership",
        "aggregate": "sum",
        "format": ",",
        "title": "Total Ridership"
      }
    ]
  },
  "config": {}
}
